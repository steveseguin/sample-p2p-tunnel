<html>
<body>
<script>
  var connectionID = "uniqueConnectionID"; // A unique ID for the VDO.Ninja stream

  function sendCommandToOBS(command) {
    var iframe = document.getElementById("obsCommander");
    if (iframe) {
      iframe.contentWindow.postMessage({"sendData": command}, '*');
    }
  }

  // Example buttons for starting and stopping a broadcast
  function startBroadcast() { sendCommandToOBS('StartStreaming', {}); }
  function stopBroadcast() { sendCommandToOBS('StopStreaming', {}); }

  // Embedding VDO.Ninja iframe for sending commands
  window.onload = function() {
    var iframe = document.createElement("iframe");
    iframe.src = "https://vdo.ninja/?datamode&push=" + connectionID;
    iframe.style.display = "none"; // Hide the iframe
    iframe.id = "obsCommander";
    document.body.appendChild(iframe);
  };


const obsWebSocketUrl = 'ws://127.0.0.1:4444'; // Replace with your OBS WebSocket server URL

let obsSocket = new WebSocket(obsWebSocketUrl);

obsSocket.onopen = function() {
  console.log('Connected to OBS WebSocket server.');

  // Authenticate if your OBS WebSocket server requires authentication
  // sendCommandToOBS('GetAuthRequired', {}).then(... handle authentication ...);

  // To start the broadcast
  sendCommandToOBS('StartStreaming', {});

  // To stop the broadcast
  // sendCommandToOBS('StopStreaming', {});
};

obsSocket.onmessage = function(event) {
  console.log('Message from OBS:', event.data);
};

obsSocket.onerror = function(error) {
  console.error('WebSocket Error:', error);
};

function sendCommand(requestType, requestData) {
  return new Promise((resolve, reject) => {
    const messageId = generateMessageId();
    const message = JSON.stringify({
      'request-type': requestType,
      'message-id': messageId,
      ...requestData
    });

    obsSocket.send(message);

    obsSocket.onmessage = function(event) {
      let response = JSON.parse(event.data);
      if (response['message-id'] === messageId) {
        resolve(response);
      }
    };

    obsSocket.onerror = function(error) {
      reject(error);
    };
  });
}

function generateMessageId() {
  return Math.random().toString(36).substring(2, 15);
}
</script>
<button onclick="startBroadcast()">Start Broadcast</button>
<button onclick="stopBroadcast()">Stop Broadcast</button>
</body>
</html>
